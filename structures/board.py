from dataclasses import dataclass
from typing import Optional

from structures.cell import Cell, Objective

BOARD_WIDTH = 15
BOARD_HEIGHT = 15

@dataclass
class Board:
    height: int
    width: int
    cells: dict[int, Cell]

    def __init__(self, height: int, width: int, filename: Optional[str]):
        self.height = height
        self.width = width
        if filename:
            self._process_file(filename)
        else:
            self.cells = {
                0: Cell(0, 0),
                1: Cell(1, 0),
                2: Cell(2, 0),
                3: Cell(3, 15),
                4: Cell(4, 15),
                5: Cell(5, 15),
                6: Cell(6, 15),
                7: Cell(7, 15),
                8: Cell(8, 15),
                9: Cell(9, 9),
                10: Cell(10, 10),
                11: Cell(11, 12),
                12: Cell(12, 9),
                13: Cell(13, 10, Objective.OXYGEN_TANK),
                14: Cell(14, 12),
                15: Cell(15, 0),
                16: Cell(16, 0),
                17: Cell(17, 0),
                18: Cell(18, 9),
                19: Cell(19, 10),
                20: Cell(20, 10),
                21: Cell(21, 12),
                22: Cell(22, 13, Objective.EXIT),
                23: Cell(23, 9),
                24: Cell(24, 6),
                25: Cell(25, 15),
                26: Cell(26, 5),
                27: Cell(27, 3),
                28: Cell(28, 12),
                29: Cell(29, 5), 
                30: Cell(30, 0),
                31: Cell(31, 0),
                32: Cell(32, 0),
                33: Cell(33, 5),
                34: Cell(34, 15),
                35: Cell(35, 15),
                36: Cell(36, 3),
                37: Cell(37, 2),
                38: Cell(38, 6),
                39: Cell(39, 15),
                40: Cell(40, 15),
                41: Cell(41, 3),
                42: Cell(42, 8),
                43: Cell(43, 2),
                44: Cell(44, 4),
                45: Cell(45, 0),
                46: Cell(46, 0),
                47: Cell(47, 0),
                48: Cell(48, 3),
                49: Cell(49, 8),
                50: Cell(50, 14, Objective.OXYGEN_TANK),
                51: Cell(51, 9),
                52: Cell(52, 8),
                53: Cell(53, 12, Objective.OXYGEN_TANK),
                54: Cell(54, 0),
                55: Cell(55, 0),
                56: Cell(56, 0),
                57: Cell(57, 5),
                58: Cell(58, 15),
                59: Cell(59, 5),
                60: Cell(60, 0),
                61: Cell(61, 0),
                62: Cell(62, 0),
                63: Cell(63, 15),
                64: Cell(64, 1),
                65: Cell(65, 8),
                66: Cell(66, 2),
                67: Cell(67, 0),
                68: Cell(68, 4),
                69: Cell(69, 0),
                70: Cell(70, 0),
                71: Cell(71, 0),
                72: Cell(72, 5),
                73: Cell(73, 15),
                74: Cell(74, 5),
                75: Cell(75, 0),
                76: Cell(76, 0),
                77: Cell(77, 0),
                78: Cell(78, 9),
                79: Cell(79, 2),
                80: Cell(80, 6),
                81: Cell(81, 15),
                82: Cell(82, 1),
                83: Cell(83, 6),
                84: Cell(84, 0),
                85: Cell(85, 0),
                86: Cell(86, 0),
                87: Cell(87, 3),
                88: Cell(88, 8),
                89: Cell(89, 6),
                90: Cell(90, 9),
                91: Cell(91, 8),
                92: Cell(92, 12),
                93: Cell(93, 1),
                94: Cell(94, 8),
                95: Cell(95, 12),
                96: Cell(96, 9),
                97: Cell(97, 2),
                98: Cell(98, 12),
                99: Cell(99, 15),
                100: Cell(100, 15),
                101: Cell(101, 15),
                102: Cell(102, 15),
                103: Cell(103, 5),
                104: Cell(104, 15),
                105: Cell(105, 1),
                106: Cell(106, 0, Objective.PRESSURE_PLATE),
                107: Cell(107, 4),
                108: Cell(108, 1),
                109: Cell(109, 0),
                110: Cell(110, 0),
                111: Cell(111, 4),
                112: Cell(112, 15),
                113: Cell(113, 1),
                114: Cell(114, 10),
                115: Cell(115, 10),
                116: Cell(116, 8),
                117: Cell(117, 10),
                118: Cell(118, 4),
                119: Cell(119, 15),
                120: Cell(120, 1),
                121: Cell(121, 2),
                122: Cell(122, 4),
                123: Cell(123, 1),
                124: Cell(124, 2),
                125: Cell(125, 6),
                126: Cell(126, 3),
                127: Cell(127, 8),
                128: Cell(128, 6),
                129: Cell(129, 15),
                130: Cell(130, 15),
                131: Cell(131, 7, Objective.OXYGEN_TANK),
                132: Cell(132, 15),
                133: Cell(133, 5),
                134: Cell(134, 15),
                135: Cell(135, 5),
                136: Cell(136, 15),
                137: Cell(137, 5),
                138: Cell(138, 1),
                139: Cell(139, 8),
                140: Cell(140, 8, Objective.OXYGEN_TANK),
                141: Cell(141, 8),
                142: Cell(142, 0),
                143: Cell(143, 12),
                144: Cell(144, 15),
                145: Cell(145, 15),
                146: Cell(146, 15),
                147: Cell(147, 9),
                148: Cell(148, 6),
                149: Cell(149, 15),
                150: Cell(150, 1),
                151: Cell(151, 10),
                152: Cell(152, 0),
                153: Cell(153, 0),
                154: Cell(154, 0),
                155: Cell(155, 0),
                156: Cell(156, 0),
                157: Cell(157, 0),
                158: Cell(158, 4),
                159: Cell(159, 15),
                160: Cell(160, 13, Objective.PRESSURE_PLATE),
                161: Cell(161, 15),
                162: Cell(162, 5),
                163: Cell(163, 15),
                164: Cell(164, 13, Objective.OXYGEN_TANK),
                165: Cell(165, 3),
                166: Cell(166, 8),
                167: Cell(167, 6),
                168: Cell(168, 3),
                169: Cell(169, 0),
                170: Cell(170, 2),
                171: Cell(171, 2),
                172: Cell(172, 0),
                173: Cell(173, 4),
                174: Cell(174, 15),
                175: Cell(175, 5),
                176: Cell(176, 15),
                177: Cell(177, 3),
                178: Cell(178, 8),
                179: Cell(179, 6),
                180: Cell(180, 9),
                181: Cell(181, 4),
                182: Cell(182, 15),
                183: Cell(183, 15),
                184: Cell(184, 5),
                185: Cell(185, 15),
                186: Cell(186, 9, Objective.OXYGEN_TANK),
                187: Cell(187, 0),
                188: Cell(188, 4),
                189: Cell(189, 9),
                190: Cell(190, 0),
                191: Cell(191, 10),
                192: Cell(192, 12),
                193: Cell(193, 5),
                194: Cell(194, 15), 
                195: Cell(195, 5),
                196: Cell(196, 7, Objective.OXYGEN_TANK),
                197: Cell(197, 9),
                198: Cell(198, 12),
                199: Cell(199, 5),
                200: Cell(200, 9),
                201: Cell(201, 0),
                202: Cell(202, 0),
                203: Cell(203, 4),
                204: Cell(204, 1),
                205: Cell(205, 6, Objective.OXYGEN_TANK),
                206: Cell(206, 15),
                207: Cell(207, 5),
                208: Cell(208, 5),
                209: Cell(209, 15),
                210: Cell(210, 3),
                211: Cell(211, 10),
                212: Cell(212, 6),
                213: Cell(213, 3),
                214: Cell(214, 2),
                215: Cell(215, 6),
                216: Cell(216, 3),
                217: Cell(217, 2),
                218: Cell(218, 2),
                219: Cell(219, 6),
                220: Cell(220, 15),
                221: Cell(221, 15),
                222: Cell(222, 3),
                223: Cell(223, 6),
                224: Cell(224, 15),
            }

    def _process_file(self, filename: str):
        # TODO: Implement file processing
        pass

    @staticmethod
    def id_to_cartesian(id: int) -> tuple[int, int]:
        return divmod(id, BOARD_WIDTH)

    @staticmethod
    def cartesian_to_id(x: int, y: int) -> int:
        return y * BOARD_WIDTH + x

    @staticmethod
    def cartesian_to_tile_index(coordinates: tuple[int, int]) -> int:
        return (coordinates[0] % BOARD_WIDTH) * BOARD_WIDTH + (coordinates[1] % BOARD_HEIGHT)

